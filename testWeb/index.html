
<!DOCTYPE html>
<html>
<head>
    <title>test</title>
    <meta name="referrer" content="origin">
     <style>html{height: 100%}body{ font-size: 44px;color: red;height: 100%;}</style>
</head>
<body>
    <div><span style="font-size: 12px">2222</span></div>
    <div><span style="font-size: 12px">2222</span></div>
    <div>sss<textarea name=""  id="letterInput" rows="10" ></textarea></div>
</body>
<script>
    function callTest() {
        console.log('callTest', arguments)
        // doWrite();
    }

    function doWrite() {
        var tt = `
            <!DOCTYPE html>\
            <html dir="ltr" lang="zh">\
            <head>\
                <title>window.i18n_data_mail['ck4.editor'], ck4</title>\
                <style>html{height: 100%}body{ font-size: 44px;color: red;height: 100%;}</style>
                <script id="cke_actscrpt" type="text/javascript">\
                var wasLoaded = 0;\

                function onload() {\
                    console.log("onload");\
                    if (!wasLoaded) window.parent && window.parent.callTest(62, window);\
                    wasLoaded = 1;\
                }\
                document.addEventListener("DOMContentLoaded", onload, false);\
                <\/script>\
            <\/head>\
            <body tabindex="0" aria-label="window.i18n_data_mail['ck4.editor'], ck4" role="textbox" aria-multiline="true"><div><span style="font-size: 12px;background: blue">new</span></div><\/body>\
            <\/html>\
        `;
        document.write(tt);
        document.close();
    }
</script>
<script>
    function reWrite() {
        document.write(`
            <!DOCTYPE html>\
            <html><head><title>编辑邮件正文</title>\
            <meta name="referrer" content="origin">\
            <style>html{height: 100%}body{ font-size: 44px;color: red;height: 100%;}</style>\
            </head>\
            <body class="nui-scroll" spellcheck="false" autocorrect="false">\
            <div><span style="font-size: 12px;">333</span></div>\
            <div><span style="font-size: 12px;">333</span></div>\
            </body></html>\
        `)
    }
</script>
<script>
    setTimeout(() => {
        // reWrite();
    })
</script>
<script>
    function inputText(text) {

        function upper(s) {
            if (['', null].includes(s) || s.trim() === '') {
                return s;

            }
            const i = s.search(/\S|$/);

            return s.substring(0, i) + s.substr(i, 1).toUpperCase() + s.substring(i + 1).toLowerCase();

            return s[0].toUpperCase() + s.slice(1).toLowerCase();
        }

        var reg =  /(\r\n\n|\n\n|\n\r\n\r|\r\n|\n\r|\r\n\r\n|\r|\n)+|([.\/!$?;:{}()])+/gm;
        var index = 0;
        var result = [];

        while(true) {
            let r = reg.exec(text);
            const str = text.substring(index, r ? r.index : text.length);
            result.push(upper(str));

            index = reg.lastIndex;
            if (r) {
                result.push(r[0])
            } else {
                break;
            }
        }

        return result.join('');

    }
</script>
<script>
    var letterInputItem = document.querySelector('#letterInput');
    letterInputItem.addEventListener('keydown', (e) => {
        const text = inputText(letterInputItem.value);
        letterInputItem.value = text;
    })
</script>
</html>